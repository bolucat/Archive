!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["utils/ip-show"]=t():e["utils/ip-show"]=t()}(globalThis,(()=>(()=>{"use strict";var e,t,i={206:e=>{e.exports=coreApis.componentApis.utils.commentApis}},a={};function s(e){var t=a[e];if(void 0!==t)return t.exports;var l=a[e]={exports:{}};return i[e](l,l.exports,s),l.exports}t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,s.t=function(i,a){if(1&a&&(i=this(i)),8&a)return i;if("object"==typeof i&&i){if(4&a&&i.__esModule)return i;if(16&a&&"function"==typeof i.then)return i}var l=Object.create(null);s.r(l);var o={};e=e||[null,t({}),t([]),t(t)];for(var n=2&a&&i;"object"==typeof n&&!~e.indexOf(n);n=t(n))Object.getOwnPropertyNames(n).forEach((e=>o[e]=()=>i[e]));return o.default=()=>i,s.d(l,o),l},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var l={};return(()=>{s.d(l,{component:()=>m});const e=coreApis.componentApis.define,t=coreApis.spinQuery;let i,a=2;const o=function(e,t,a){const s=this._parentBlacklistDom(e,t,a),l=[`<div class="con ${a===t?"no-border":""}">`,`<div class="user">${this._createNickNameDom(e)}`,this._createLevelLink(e),this._identity(e.mid,e.assist,e.member.fans_detail),`${this._createNameplate(e.member.nameplate)+this._createUserSailing(e)}</div>`,this._createMsgContent(e),this._createPerfectReply(e),'<div class="info">',this._createPlatformDom(e.content.plat),'<span class="time-location">','<span class="reply-time">'.concat(this._formateTime(e.ctime),"</span>"),e?.reply_control?.location?`<span class="reply-location" style="margin-left:15px;">${e?.reply_control?.location||""}</span>`:"","</span>",e.lottery_id?"":`<span class="like ${1===e.action?"liked":""}"><i></i><span>${e.like?e.like:""}</span></span>`,e.lottery_id?"":`<span class="hate ${2===e.action?"hated":""}"><i></i></span>`,e.lottery_id?"":this._createReplyBtn(e.rcount),e.lottery_id&&e.mid!==i.userStatus.mid?"":`<div class="operation more-operation"><div class="spot"></div><div class="opera-list"><ul>${this._canSetTop(e)?`<li class="set-top">${e.isUpTop?"取消置顶":"设为置顶"}</li>`:""}${this._canBlackList(e.mid)?'<li class="blacklist">加入黑名单</li>':""}${this._canReport(e.mid)?'<li class="report">举报</li>':""}${this._canDel(e.mid)&&!e.isTop?`<li class="del" data-mid="${e.mid}">删除</li>`:""}</ul></div></div>`,this._createLotteryContent(e.content),this._createVoteContent(e.content),this._createTags(e),"</div>",'<div class="reply-box">',this._createSubReplyList(e.replies,e.rcount,!1,e.rpid,e.folder&&e.folder.has_folded,e.reply_control),"</div>",'<div class="paging-box">',"</div>","</div>"].join("");return e.state===i.blacklistCode?s:l},n=function(e,t){return[`<div class="reply-item reply-wrap" data-id="${e.rpid}" data-index="${t}">`,this._createSubReplyUserFace(e),'<div class="reply-con">','<div class="user">',this._createNickNameDom(e),this._createLevelLink(e),this._identity(e.mid),this._createSubMsgContent(e),"</div>","</div>",'<div class="info">','<span class="time-location">','<span class="reply-time">'.concat(this._formateTime(e.ctime),"</span>"),e?.reply_control?.location?`<span class="reply-location" style="margin-left:15px;">${e?.reply_control?.location||""}</span>`:"","</span>",`<span class="like ${1===e.action?"liked":""}"><i></i><span>${e.like?e.like:""}</span></span>`,`<span class="hate ${2===e.action?"hated":""}"><i></i></span>`,'<span class="reply btn-hover">回复</span>',`<div class="operation btn-hover btn-hide-re"><div class="spot"></div><div class="opera-list"><ul>${this._canBlackList(e.mid)?'<li class="blacklist">加入黑名单</li>':""}${this._canReport(e.mid)?'<li class="report">举报</li>':""}${this._canDel(e.mid)?`<li class="del" data-mid="${e.mid}">删除</li>`:""}</ul></div></div>`,"</div>","</div>"].join("")},r=function(e,t,i){const a=this._parentBlacklistDom(e,t,i),s=[`<div class="con ${i===t?"no-border":""}">`,`<div class="user">${this._identity(e.mid,e.assist,e.member.fans_detail)}`,`<a data-usercard-mid="${e.mid}" href="//space.bilibili.com/${e.mid}" target="_blank" class="name ${this._createVipClass(e.member.vip.vipType,e.member.vip.vipStatus,e.member.vip.themeType)}">${this._unhtmlFix(e.member.uname)}</a><a class="level-link" href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l${e.member.level_info.current_level}"></i></a>${this._createNameplate(e.member.nameplate)}${this._createUserSailing(e.member&&e.member.user_sailing||{})}</div>`,this._createMsgContent(e),'<div class="info">',e.floor?`<span class="floor">#${e.floor}</span>`:"",this._createPlatformDom(e.content.plat),`<span class="time">${this._formateTime(e.ctime)}</span>`,e?.reply_control?.location?`<span style="margin-left:0px;">${e?.reply_control?.location||""}</span>`:"",e.lottery_id?"":`<span class="like ${1===e.action?"liked":""}"><i></i><span>${e.like||""}</span></span>`,e.lottery_id?"":`<span class="hate ${2===e.action?"hated":""}"><i></i></span>`,e.lottery_id?"":this._createReplyBtn(e.rcount),e.lottery_id&&e.mid!==this.userStatus.mid?"":`<div class="operation more-operation"><div class="spot"></div><div class="opera-list"><ul>${this._canSetTop(e)?`<li class="set-top">${e.isUpTop?"取消置顶":"设为置顶"}</li>`:""}${this._canBlackList(e.mid)?'<li class="blacklist">加入黑名单</li>':""}${this._canReport(e.mid)?'<li class="report">举报</li>':""}${this._canDel(e.mid)&&!e.isTop?`<li class="del" data-mid="${e.mid}">删除</li>`:""}</ul></div></div>`,this._createLotteryContent(e.content),this._createVoteContent(e.content),this._createTags(e),"</div>",'<div class="reply-box">',this._createSubReplyList(e.replies,e.rcount,!1,e.rpid,e.folder&&e.folder.has_folded),"</div>",'<div class="paging-box">',"</div>","</div>"].join("");return e.state===this.blacklistCode?a:s},c=function(e,t){return[`<div class="reply-item reply-wrap" data-id="${e.rpid}" data-index="${t}">`,`<a href="//space.bilibili.com/${e.mid}" data-usercard-mid="${e.mid}" target="_blank" class="reply-face">`,`<img src="${this._trimHttpFix(this._webpFix(e.member.avatar,{w:52,h:52}))}" alt="">`,"</a>",'<div class="reply-con">','<div class="user">',`<a href="//space.bilibili.com/${e.mid}" target="_blank" data-usercard-mid="${e.mid}" class="name ${this._createVipClass(e.member.vip.vipType,e.member.vip.vipStatus,e.member.vip.themeType)}">${this._unhtmlFix(e.member.uname)}</a>`,`<a class="level-link" href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l${e.member.level_info.current_level}"></i></a>`,this._createSubMsgContent(e),"</div>","</div>",'<div class="info">',`<span class="time">${this._formateTime(e.ctime)}</span>`,e?.reply_control?.location?`<span style="margin-left:0px;">${e?.reply_control?.location||""}</span>`:"",`<span class="like ${1===e.action?"liked":""}"><i></i><span>${e.like||""}</span></span>`,`<span class="hate ${2===e.action?"hated":""}"><i></i></span>`,'<span class="reply btn-hover">回复</span>',`<div class="operation btn-hover btn-hide-re"><div class="spot"></div><div class="opera-list"><ul>${this._canBlackList(e.mid)?'<li class="blacklist">加入黑名单</li>':""}${this._canReport(e.mid)?'<li class="report">举报</li>':""}${this._canDel(e.mid)?`<li class="del" data-mid="${e.mid}">删除</li>`:""}</ul></div></div>`,"</div>","</div>"].join("")},p=new MutationObserver((e=>{e.forEach((()=>{void 0!==unsafeWindow.bbComment&&(i=unsafeWindow.bbComment,"blackroom"===unsafeWindow.location.href.split("/")[3]?(i.prototype._unhtmlFix=function(e,t){return e?
// eslint-disable-next-line @typescript-eslint/no-shadow
e.replace(t||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp|#\\d+);)?/g,(function(e,t){return t?e:{"<":"","&":"",'"':"",">":"","'":""}[e]})):""},i.prototype._trimHttpFix=function(e){return e?e.replace(/^http:/,""):""},i.prototype._webpFix=function(e,t){if(!e)return e;const i=e.match(/(.*\\.(jpg|jpeg|gif|png|bmp))(\\?.*)?/);let a=-1!==e.indexOf("/bfs/");return i&&"gif"!==i[2]&&"bmp"!==i[2]&&a?(a=t.w,e=t.h,e=a&&e?`@${a}w_${e}h`:"@",t=i[3]||"",this.isWebp?`${i[1]+e}.webp${t}`:`${i[1]+e}.${i[2]}${t}`):e},i.prototype._createListCon=r,i.prototype._createSubReplyItem=c):(i.prototype._createListCon=o,i.prototype._createSubReplyItem=n),a=1,p.disconnect())}))}));p.observe(document.head,{childList:!0});const d=e=>{e.forEach((async e=>{const i=(e=>e.frameworkSpecificProps?.reply_control?.location??void 0)(e);if(void 0===i)return;const a=await(e.shadowDomEntry?(0,t.select)((()=>e.shadowDomEntry.querySelector("#pubdate")),{queryInterval:100,maxRetry:30}):e.element.querySelector(".reply-info>.reply-time")??e.element.querySelector(".sub-reply-info>.sub-reply-time"));if(null===a)return;const s=a.querySelector(".ip-location");if(null!==s)return void(s.innerText=i);const l=document.createElement("span");l.className="ip-location",l.style.marginLeft="15px",l.innerText=i,a.appendChild(l)}))},m=(0,e.defineComponentMetadata)({name:"ipShow",author:{name:"Light_Quanta",link:"https://github.com/LightQuanta"},displayName:"评论区IP属地显示",tags:[componentsTags.utils],entry:async()=>{const{forEachCommentItem:e}=await Promise.resolve().then(s.t.bind(s,206,23));e({added:e=>{2===a&&(d([e,...e.replies]),e.addEventListener("repliesUpdate",(e=>d(e.detail))))}})},description:{"zh-CN":"在评论区显示评论的IP属地信息"},commitHash:"8ac161b8db84fd53e1bdeea0675e099a08337d9f",coreVersion:"2.9.6"})})(),l=l.component})()));